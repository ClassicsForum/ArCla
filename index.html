<!DOCTYPE html>
<!-- To make this next year:
  * Download candidate spreadsheet
  * Search-replace all commas with an unlikely character, such as }
  * Export to CSV
  * Use a CSV-to-HTML converter to make the table (I used http://xmlgrid.net/csvToHtml.html)
  * Copy-paste this into a following-year file
  * Replace the table in the following-year file with your new table
  * Search/replace to be sure that "AILA", "APALA", "BCALA", and "CALA" are used in the ethnic
    caucus columns, not just the fully-spelled-out versions
  * Search/replace the } to turn it back into ,
  * Search/replace &; to &amp; (and then fix the && in the Javascript, and this line)
  * Search/replace <tr> with <tr class="initial-show"> (except in this line, and in the first row of the table, which should have <tr class="header=row">)
  * Test to see if it works. Who knows what the data format is. In particular, the nth-child
    selectors are all totally fragile around column reordering. (Protip: the nth-child selector
    is 1-indexed because what is this, Mars?)
  * Update the voting button if needed.
-->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>ArCla : Archives of Classical Scholarship directory sorter</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

    <style type="text/css">
      table {
        margin-top: 20px;
      }

      tr {
        display: none;
      }

      .initial-show {
        display: inherit;
      }

      tr.success {
        display: inherit;
      }

      /* It's important that the hide classes go AFTER the show classes so that hiding
         behavior overrides showing behavior (by virtue of CSS cascading) - in order to
         AND facets together, we need to say that *all* of them must have show behavior
         to be displayed, which means that *any* with hide behavior should trump all
         show behavior.
      */
      .division-show, .rt-show, .caucus-show, .type-show, .state-show, .spectrum-show, .el-show {
        display: inherit;
      }

      .division-hide, .rt-hide, .caucus-hide, .type-hide, .state-hide, .spectrum-hide, .el-hide {
        display: none;
      }

      tr.header-row {
        /* Header row. */
        display: inherit;
        background-color: #fbd986;
      }

      .wide {
        min-width: 200px;
      }

      .extra-wide {
        min-width: 400px;
      }

      .extra-extra-wide {
        min-width: 600px;
      }

      .btn.btn-default {
        padding: 3px 6px;
        margin-bottom: 3px;
      }

      .btn-default.active {
        background-color: #fbd986;
      }

      header.jumbotron {
        background-color: rgb(215, 153, 0);
        color: white;
      }

    </style>
  </head>
  <body>

  <header class="jumbotron">
    <div class="container">
      <h1>ArCla : Archives of Classical Scholarship 
directory sorter</h1>
    </div>
  </header>

  <div class="container">

  <!-- begin filter area -->
  <div class="row filter-buttons">

    <!-- begin filter button panels -->
    <div class="col-sm-10">

      <!-- begin first row of filters -->
      <div class="row">
        <div class="col-sm-4">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Birthplace</h3>
            </div>
            <div class="panel-body" id="filter-divisions">
              <button type="button" class="btn btn-default" id="United States">United States</button>
              <button type="button" class="btn btn-default" id="Germany">Germany</button>
              <button type="button" class="btn btn-default" id="Italy">Italy</button>
              <button type="button" class="btn btn-default" id="Greece">Greece</button>
              <button type="button" class="btn btn-default" id="a">a</button>
              <button type="button" class="btn btn-default" id="b">b</button>
              <button type="button" class="btn btn-default" id="c">c</button>
              <button type="button" class="btn btn-default" id="d">d</button>
              <button type="button" class="btn btn-default" id="e">e</button>
              <button type="button" class="btn btn-default" id="f">f</button>
              <button type="button" class="btn btn-default" id="g">g</button>
            </div>
          </div>
        </div>

        <div class="col-sm-4">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Main Affiliation Region</h3>
            </div>
            <div class="panel-body" id="filter-rts">
              <button type="button" class="btn btn-default" id="US West">US West</button>
              <button type="button" class="btn btn-default" id="US Midwest">US Midwest</button>
              <button type="button" class="btn btn-default" id="US Northeast">US Northeast</button>
              <button type="button" class="btn btn-default" id="US South">US South</button>
              <button type="button" class="btn btn-default" id="Germany">Germany</button>
              <button type="button" class="btn btn-default" id="Italy">Italy</button>
              <button type="button" class="btn btn-default" id="Greece">Greece</button>
              <button type="button" class="btn btn-default" id="h">h</button>
              <button type="button" class="btn btn-default" id="i">i</button>
            </div>
          </div>
        </div>

        <div class="col-sm-4">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Location of Papers</h3>
            </div>
            <div class="panel-body" id="filter-caucuses">
              <button type="button" class="btn btn-default" id="US West">US West</button>
              <button type="button" class="btn btn-default" id="US Midwest">US Midwest</button>
              <button type="button" class="btn btn-default" id="US Northeast">US Northeast</button>
              <button type="button" class="btn btn-default" id="US South">US South</button>
              <button type="button" class="btn btn-default" id="California">California</button>
              <button type="button" class="btn btn-default" id="Massachusetts">Massachusetts</button>
              <button type="button" class="btn btn-default" id="New York">New York</button>
              <button type="button" class="btn btn-default" id="Greece">Greece</button>
           </div>
          </div>
        </div>
      </div>
      <!-- end first row of filters -->

      <!-- begin second row of filters -->
      <div class="row">

        <div class="col-sm-4">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Final Degree</h3>
            </div>
            <div class="panel-body" id="filter-types">
              <button type="button" class="btn btn-default" id="Doctorate">PhD</button>
              <button type="button" class="btn btn-default" id="Doctorate">Doctorate</button>
             <button type="button" class="btn btn-default" id="Master's">Master's</button>
              <button type="button" class="btn btn-default" id="Bachelor's">Bachelor's</button>
              <button type="button" class="btn btn-default" id="High School and Other">High School and Other</button>
           </div>
          </div>
        </div>

        <div class="col-sm-4">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Birthdate Vicennial (20 Years)</h3>
            </div>
            <div class="panel-body" id="filter-caucuses">
              <button type="button" class="btn btn-default" id="1701-1720">1701-1720</button>
              <button type="button" class="btn btn-default" id="1721-1740">1721-1740</button>
              <button type="button" class="btn btn-default" id="1741-1760">1741-1760</button>
              <button type="button" class="btn btn-default" id="1761-1780">1761-1780</button>
              <button type="button" class="btn btn-default" id="1781-1800">1781-1800</button>
              <button type="button" class="btn btn-default" id="1801-1820">1801-1820</button>
              <button type="button" class="btn btn-default" id="1821-1840">1821-1840</button>
              <button type="button" class="btn btn-default" id="1841-1860">1841-1860</button>
              <button type="button" class="btn btn-default" id="1861-1880">1861-1880</button>
              <button type="button" class="btn btn-default" id="1881-1900">1881-1900</button>
              <button type="button" class="btn btn-default" id="1901-1920">1901-1920</button>
              <button type="button" class="btn btn-default" id="1921-1940">1921-1940</button>
              <button type="button" class="btn btn-default" id="1941-1960">1941-1960</button>
              <button type="button" class="btn btn-default" id="1961-1980">1961-1980</button>
              <button type="button" class="btn btn-default" id="1981-2000">1981-2000</button>
              <button type="button" class="btn btn-default" id="2001-2020">2001-2020</button>
           </div>
          </div>
        </div>

        <div class="col-sm-4">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Deathdate Vicennial (20 Years)</h3>
            </div>
            <div class="panel-body" id="filter-caucuses">
              <button type="button" class="btn btn-default" id="1701-1720">1701-1720</button>
              <button type="button" class="btn btn-default" id="1721-1740">1721-1740</button>
              <button type="button" class="btn btn-default" id="1741-1760">1741-1760</button>
              <button type="button" class="btn btn-default" id="1761-1780">1761-1780</button>
              <button type="button" class="btn btn-default" id="1781-1800">1781-1800</button>
              <button type="button" class="btn btn-default" id="1801-1820">1801-1820</button>
              <button type="button" class="btn btn-default" id="1821-1840">1821-1840</button>
              <button type="button" class="btn btn-default" id="1841-1860">1841-1860</button>
              <button type="button" class="btn btn-default" id="1861-1880">1861-1880</button>
              <button type="button" class="btn btn-default" id="1881-1900">1881-1900</button>
              <button type="button" class="btn btn-default" id="1901-1920">1901-1920</button>
              <button type="button" class="btn btn-default" id="1921-1940">1921-1940</button>
              <button type="button" class="btn btn-default" id="1941-1960">1941-1960</button>
              <button type="button" class="btn btn-default" id="1961-1980">1961-1980</button>
              <button type="button" class="btn btn-default" id="1981-2000">1981-2000</button>
              <button type="button" class="btn btn-default" id="2001-2020">2001-2020</button>
           </div>
          </div>
        </div>
   
     <div class="col-sm-8">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Main Affiliation US State</h3>
            </div>
            <div class="panel-body" id="filter-states">
            </div>
          </div>
        </div>
      </div>
      <!-- end second row of filters -->

    </div>
    <!-- end filter button panels -->

    <!-- begin filter logic explainer -->
    <div class="col-sm-2 border-left full-height">
      <em>Birthplace, Main Affiliation, Location of Papers, and Final Degree use OR within facets and AND between facets. Contrast Birthplace with Main Affiliation.</em>
    </div>
    <!-- end filter logic explainer -->

  </div>
  <!-- end filter area -->

  <hr />

  <!-- begin spectrum/EL button area -->
  <div class="row filter-buttons">
    <div class="col-sm-10">
      <button type="button" class="btn btn-default" id="spectrum">Women</button>
      <button type="button" class="btn btn-default" id="EL">Refugees</button>
    </div>
    <div class="col-sm-2">
      <em>These are Booleans.</em>
    </div>
  </div>
  <!-- end spectrum/EL button area -->

  <hr />

  <p class="text-center">
    <a href="http://www.classicslibrarians.org/" class="btn btn-success btn-lg">Check out the FCLSC</a><br />
    <em>Research Team: Sarah Buchanan, David Schenker, Clarabelle Fields. Thank you to our Project Advisors: RL, LB, WB, GC, and the late DS.</em>
  </p>

  <br />

  <table class="table table-hover table-bordered">
    <!--Created with XmlGrid Free Online XML Editor (http://xmlgrid.net)-->
    <tr class="header-row">
          <td>First+Middle Name</td>
          <td>Last Name</td>
          <td>Birthplace</td>
          <td>Main Affiliation</td>
          <td>Main Affiliation Region</td>
          <td>Location of Papers Region</td>
          <td>Final Degree</td>
          <td>Birthdate Vicennial</td>
          <td>Deathdate Vicennial</td>
          <td>Degree Granting Institution</td>
          <td>Main Affiliation US State</td>
          <td>Woman?</td>
          <td>Refugee?</td>
          <td>Collection Name+Number</td>
          <td>Link to Collection Info</td>
          <td>Location of Archive</td>
          <td>Correspondents</td>
          <td>Birthdate</td>
          <td>Death date</td>
          <td>Major Accomplishments</td>
          <td>Offices held in the APA / SCS, state, &amp; regional Classics associations, &amp; other associations</td>
    </tr>
    <tr class="initial-show">
          <td>Frank Frost</td>
          <td>Abbott</td>
          <td>birthplace</td>
          <td>Princeton University</td>
          <td>US Northeast</td>
          <td>US Northeast</td>
          <td>PhD</td>
          <td>1841-1860</td>
          <td>1921-1940</td>
          <td>Yale University</td>
          <td>NJ</td>
          <td>No</td>
          <td>tbd</td>
          <td>Paul Elmer More Papers (1916), 26999</td>
          <td>link</td>
          <td>Princeton University</td>
          <td>Paul Elmer More</td>
          <td>1860-03-27</td>
          <td>1924-07-23</td>
     <td></td>
    </tr>
    <tr class="initial-show">
          <td>Kenneth Morgan</td>
          <td>Abbott</td>
          <td>birthplace</td>
          <td>Ohio State University, University of Illinois</td>
          <td>US Northeast</td>
          <td>US Northeast</td>
          <td>PhD</td>
          <td>1901-1920</td>
          <td>1981-2000</td>
          <td>University of Illinois</td>
          <td>OH, IL</td>
          <td>No</td>
          <td>tbd</td>
          <td>tba</td>
          <td>link</td>
          <td>tba</td>
          <td>tba</td>
          <td>1906-05-03</td>
          <td>1988-07-21</td>
    </tr>
  </table>

</div>
  <!-- Le JavaScripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
  <script type="text/javascript">
  var $j = jQuery.noConflict();

  $j(document).ready(function() {

    // Initialize All The Things
    // ------------------------------------------------------------------------

    var cells_spectrum_no = $j("tr td:nth-child(10):contains('No')");
    var cells_el_no = $j("tr td:nth-child(11):contains('No')");
    var cells_spectrum_yes = $j("tr td:nth-child(10):contains('Yes')");
    var cells_el_yes = $j("tr td:nth-child(11):contains('Yes')");

    var divisions_active = [];
    var rts_active = [];
    var caucuses_active = [];
    var types_active = [];
    var states_active = [];



    // Set up some utility functions to DRY out our code
    // ------------------------------------------------------------------------

    var listify = function(table_cell) {
      // Converts a table cell containing comma-separated values to an array,
      // stripping spaces. Expects the values to be a list of acronyms
      // (e.g. "ACRL, PLA").
      return table_cell.html().replace(/\s+/g, '').split(',');
    }

    var listify_expanded = function(table_cell) {
      // Converts a table cell containing comma-separated values to an array,
      // stripping spaces. Expects the values to be a list of expanded forms
      // with acronyms in parentheses (e.g. "Social Responsibilities Round
      // Table (SRRT)").
      var re = /\([A-Z]+\)/g;
      var matches = table_cell.html().match(re);

      if ( matches ) {
        // We can't get the global match to pay attention to capture groups,
        // so we have to actually strip off the parentheses. Ew.
        matches = matches.map(function(match) { return match.slice(1, -1); })
      }

      return matches
    }

    var update_active_list = function(button, active_list) {
      // Updates the list of active items in the given facet to add or remove
      // the current item, depending on the status of the button just clicked.
      var item = button.attr('id');
      if ( button.hasClass('active') ) {
        active_list.push(item);
      } else {
        var idx = active_list.indexOf(item);
        active_list.splice(idx, 1);
      }
    }

    var intersect_lists = function(list1, list2) {
        // Look at the intersection of this table cell's list of affiliations
        // and the overall list of active affiliations. Do they have at least
        // one in common? We only want to show table rows where the relevant
        // cell has at least one of the user-selected affiliations.

        if ( !list1 ) {
          // If list1 is empty (e.g. the candidate doesn't belong to any RTs),
          // the intersection is definitely empty.
          return false;
        }

        var bool = $j.grep(list1, function(i) {
            return $j.inArray(i, list2) > -1;
        }).length > 0;
        return bool;
    }

    var boolean_filter = function(button, facet) {
      // Handles the binary filters (spectrum y/n and emerging leader y/n).
      if (!(facet == 'spectrum') && !(facet=='el')) {
        // Just in case, since eval() is a nuclear weapon.
        return
      }

      button.toggleClass('active');
      cells_no = eval("cells_" + facet + "_no");
      cells_yes = eval("cells_" + facet + "_yes");

      if ( button.hasClass('active') ) {
        cells_no.parent('tr').addClass(facet + '-hide');
        cells_yes.parent('tr').addClass(facet + '-show');
      } else {
        cells_no.parent('tr').removeClass(facet + '-hide');
        cells_no.parent('tr').addClass(facet + '-show');
      }

    }



    // Set up state filter buttons. Build them from the list of states actually
    // represented rather than hand-coding a ton of states.
    //
    // ------------------------------------------------------------------------

    var states = [];
    var state_columns = $j("tr td:nth-child(20)");
    state_columns.each(function() {
      var state = $j(this).html();
      if ( states.indexOf(state) < 0 && state != 'State' ) {
        states[states.length] = state;
      }
    });
    states.sort();

    var state_filter = $j('#filter-states');
    function createStateButtons(element, index, array) {
      state_filter.append('<button type="button" class="btn btn-default" id="' + element + '">' + element +'</button> ');
    }
    states.forEach(createStateButtons);
    state_filter.append("<p><em>(Not all states have candidates in this election.)</em></p>");



    // On pageload all candidates are shown; the first time any filters are
    // activated, they should be hidden, and then selectively revealed only
    // where consistent with filters.
    //
    // ------------------------------------------------------------------------

    $j('.filter-buttons button').click(function() {
      $j('tr').removeClass('initial-show');
    });



    // Below here, we filter things when users click buttons.
    // ------------------------------------------------------------------------

    // Le multiselect facets --------------------------------------------------

    $j('#filter-divisions button').click(function() {
      $j(this).toggleClass('active');

      update_active_list($j(this), divisions_active);

      // Examine the table cells containing division membership info.
      var division_cells = $j('td:nth-child(7)');
      division_cells.each(function() {
        var row = $j(this).parent('tr'); // The row containing this cell.

        var cell_divs = listify($j(this));
        var bool = intersect_lists(cell_divs, divisions_active);

        // Add the divisional show or hide class to this row, depending on
        // whether the division lists had any divisions in common.
        if ( bool ) {
          if ( !row.hasClass('division-show') ) {
            row.addClass('division-show');
          }
          row.removeClass('division-hide');
        } else {
          row.addClass('division-hide');
        }
      });
    });

    $j('#filter-rts button').click(function() {
      $j(this).toggleClass('active');

      update_active_list($j(this), rts_active);

      var rt_cells = $j('td:nth-child(8)');

      rt_cells.each(function() {
        var row = $j(this).parent('tr'); // The row containing this cell.

        var cell_rts = listify_expanded($j(this));
        var bool = intersect_lists(cell_rts, rts_active);

        if ( bool ) {
          if ( !row.hasClass('rt-show') ) {
            row.addClass('rt-show');
          }
          row.removeClass('rt-hide');
        } else {
          row.addClass('rt-hide');
        }
      });
    });

    $j('#filter-caucuses button').click(function() {
      $j(this).toggleClass('active');

      update_active_list($j(this), caucuses_active);

      var caucus_cells = $j("tr td:nth-child(9)");
      caucus_cells.each(function() {
        var row = $j(this).parent('tr'); // The row containing this cell.

        var cell_caucuses = listify($j(this));

        var bool = intersect_lists(cell_caucuses, caucuses_active);

        if ( bool ) {
          if ( !row.hasClass('caucus-show') ) {
            row.addClass('caucus-show');
          }
          row.removeClass('caucus-hide');
        } else {
          row.addClass('caucus-hide');
        }
      });
    });

    $j('#filter-types button').click(function() {
      $j(this).toggleClass('active');

      update_active_list($j(this), types_active);

      var type_cells = $j("tr td:nth-child(4)");

      type_cells.each(function() {
        var row = $j(this).parent('tr'); // The row containing this cell.

        var cell_types = listify($j(this));

        // Anything other than Academic, Public, or School maps to Other.
        cell_types = cell_types.map(function(type) {
          if ( type == 'Academic' || type == 'Public' || type == 'School' ) {
            return type
          } else {
            return 'Other'
          }
        });

        var bool = intersect_lists(cell_types, types_active);

        if ( bool ) {
          if ( !row.hasClass('type-show') ) {
            row.addClass('type-show');
          }
          row.removeClass('type-hide');
        } else {
          row.addClass('type-hide');
        }
      });
    });

    $j('#filter-states button').click(function() {
      $j(this).toggleClass('active');

      update_active_list($j(this), states_active);

      var state_cells = $j("tr td:nth-child(20)");

      state_cells.each(function() {
        var row = $j(this).parent('tr'); // The row containing this cell.

        var cell_divs = listify($j(this));
        var bool = intersect_lists(cell_divs, states_active);

        if ( bool ) {
          if ( !row.hasClass('state-show') ) {
            row.addClass('state-show');
          }
          row.removeClass('state-hide');
        } else {
          row.addClass('state-hide');
        }
      });
    });

    // Le boolean facets ------------------------------------------------------

    $j('#spectrum').click(function () {
      boolean_filter($j(this), 'spectrum');
    });

    $j('#EL').click(function () {
      boolean_filter($j(this), 'el');
    });

  });
  </script>
  </body>
</html>
